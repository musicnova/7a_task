От компании Data Logia.

Тестовое задание дали на биржу BTC/ETH (альтернативно BTC/USD) за неделю сделать.
https://www.binance.com/ru
На бирже нельзя шортить (futures можно, но здесь не futures).

Написать надо робота - идиота ("поплавок"), чтобы он собрал статистику, потратив бюджет $300.

Есть два протокола работы - RestAPI и WebSocket.
(Часть вещей WebSocket не умеет. Например, аутентификацию других не умеет, но в задаче это не нужно).
Везде использовать только WebSocket , и почти нигде RestAPI.

Библиотека Python3.6 для REST - это CCXT, для WebSocket - смотреть её аналоги.

Что делает робот:
1) Знает текущий bid-ask-spread (разницу между лучшим спросом и лучшим предложением).на паре BTC/ETH (альтернативно BTC/USD)
2) Выполняет действия:
a) Шаг 1. Покупает BTC [независимо от цены]
b) Шаг 2. Продает BTC [независимо от цены] только после завершения (a)
c) Шаг 3. Покупает BTC [независимо от цены] только после завершения (b)
d) Шаг 4. Продает BTC [независимо от цены] только после завершения (c)
и т д
3) (*) Возможный критерий останова : максимум суммарной дельты (от всех bid-ask-spread) в USD превысил заданное в параметре значение

Важно: При покупке или продаже робот выполняет Best-Ask (то есть не по рынку, а по лучшей цене в стакане). Формально биржа поставит заявку в очередь в конец и если до робота всё не раскупят/распродадут, то она исполнится. Если нет, то продолжаем пытаться.
Важно2: Размер ORDER в BTC - это параметр алгоритма. Он фиксирован и равен для buy и sell. В документации (внизу главной страницы ссылка) нужно самому найти size минимальный, но меньше биржа и не дает исполнить, он где-то 1000 сатоши.


Дано: трейдинг, статистика, ключи.
Рынок считается ликвидным (с volume все ок), а биржа круглосуточная.

Задача: держаться поплавком и перепрыгивать из buy в sell и обратно.
И записать в CSV результаты действий:
1) ts_decision (когда мы приняли решение купить/продать)
2) ts_full_execution (когда полностью исполнена, не путать с close)
3) change_btc за время execution насколько изменилась дельта (bid-ask-spread) в BTC
4) change_eth за время execution насколько изменилась дельта (bid-ask-spread) в ETH (альтернативно change_usd в USD)
5) total_cnt сколько раз мы переставлялись (число каммулятивное, минимум 1 - когда нет покупок, нет и записей CSV)

Обработка ошибок биржи:
1) Если биржа не подтвердила транзакцию, то делаем Retry, Retry и т д до упора, но не останавливаемся.
2) Возможные ошибки внутри async функций предусмотреть
3) Работа без kafka, запись на диск может в теории сломаться, но тут ничего делать с этим не надо (для этого другое есть задание, когда на кластере сразу аналогичный робот стартует, подменяя упавший).

Результат - код Python + csv.
